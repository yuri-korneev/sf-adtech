<?php
/**
 * Общие настройки SF-AdTech (ядро, без «украшательств»).
 * Всё, что можно — выносим в .env, чтобы менять без деплоя.
 */

return [

    /*
    |--------------------------------------------------------------------------
    | Комиссия системы
    |--------------------------------------------------------------------------
    |
    | Хранится как доля (0..1). Например, 0.20 = 20%.
    | Для совместимости оставляем два ключа:
    |  - 'commission'           — текущий ключ (используем в коде)
    |  - 'system_commission'    — алиас на тот же env (если где-то уже дергали)
    */
    'commission'        => (float) env('SYSTEM_COMMISSION', 0.20),
    'system_commission' => (float) env('SYSTEM_COMMISSION', 0.20), // alias

    /*
    |--------------------------------------------------------------------------
    | Окно дедупликации кликов
    |--------------------------------------------------------------------------
    |
    | В секундах. ВАЖНО: окно считается относительно времени клика (ts),
    | а не времени обработки джобы.
    */
    'dedup_window_seconds' => (int) env('DEDUP_WINDOW', 30),

    /*
    |--------------------------------------------------------------------------
    | Сигнатуры ботов (простая эвристика по подстроке в User-Agent)
    |--------------------------------------------------------------------------
    |
    | Можно задать через .env в виде CSV-списка (без пробелов или с пробелами — не важно),
    | например: BOT_SIGNATURES="bot,crawler,spider,googlebot"
    */
    'bot_signatures' => array_values(array_filter(array_map('trim', explode(
        ',',
        env('BOT_SIGNATURES', 'bot,crawler,spider,googlebot,bingbot,yandexbot,duckduckbot,slurp,baiduspider')
    )))),

    /*
    |--------------------------------------------------------------------------
    | Ограничение частоты запросов (редиректор)
    |--------------------------------------------------------------------------
    |
    | Базовый лимит кликов на токен (или иной ключ) в минуту. Используем вместе
    | с Laravel throttling middleware/логикой (если подключена).
    */
    'rate_limit' => [
        'per_minute' => (int) env('CLICK_RATE_PER_MIN', 600),
    ],

    /*
    |--------------------------------------------------------------------------
    | Настройки CSV-экспорта
    |--------------------------------------------------------------------------
    |
    | Десятичная точка и разделитель тысяч влияют только на формат отображения
    | чисел в CSV, если мы сами форматируем. По умолчанию — «русский вид».
    */
    'csv' => [
        'delimiter'      => env('CSV_DELIMITER', ';'),
        'decimal_point'  => env('CSV_DECIMAL_POINT', ','),
        'thousands_sep'  => env('CSV_THOUSANDS_SEP', ' '),
        'encoding'       => env('CSV_ENCODING', 'UTF-8'),
    ],

    /*
    |--------------------------------------------------------------------------
    | Настройки сводной статистики
    |--------------------------------------------------------------------------
    |
    | Значения по умолчанию для периодов и ограничитель «глубины»
    | (на случай тяжёлых отчётов).
    */
    'stats' => [
        // today | 7d | 30d | custom — дефолт для страниц статистики
        'default_period' => env('STATS_DEFAULT_PERIOD', '7d'),
        // максимум дней для выборок (предохранитель)
        'max_days'       => (int) env('STATS_MAX_DAYS', 365),
    ],

];
